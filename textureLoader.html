<!DOCTYPE html>
<html>
<head>
    <title>texture loader</title>
</head>
<body>
</body>
<script type="text/javascript" src="three.min.js"></script>
<script src="TrackballControls.js"></script>
<script>
// instantiate a loader
var loader = new THREE.TextureLoader();
var scene = new THREE.Scene();

var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

var cam = new THREE.PerspectiveCamera(41, window.innerWidth / window.innerHeight, 1, 100000);
cam.position.set(5, 15, 25);
cam.lookAt(new THREE.Vector3(0, 0, 0));
scene.add(cam);

var camHelper = new THREE.CameraHelper(cam);
scene.add(camHelper);

var trackControl = new THREE.TrackballControls(cam, renderer.domElement);
trackControl.minDistance = 10;
trackControl.maxDistance = 10000;

var planeGeom = new THREE.PlaneGeometry(40, 40);

// add init plane
var planeMesh = new THREE.Mesh(new THREE.PlaneGeometry(40, 40),
                    new THREE.MeshBasicMaterial({color: 0x88eeff, side: THREE.DoubleSide}));
planeMesh.receiveShadow = true;
scene.add(planeMesh);

cube = new THREE.Mesh(new THREE.CubeGeometry(1, 1, 1),
        new THREE.MeshLambertMaterial({color: 0x00ff00}));
cube.position.x = 2;
cube.castShadow = true;
// scene.add(cube);


var ambientlight = new THREE.AmbientLight(0xffffff);
scene.add(ambientlight);

requestAnimationFrame(draw);

function draw() {
    trackControl.update();
    camHelper.update();
    renderer.render(scene, cam);
    requestAnimationFrame(draw);
}

function addTexture(texture) {
    console.log('texture loaded.')
    var material = new THREE.MeshLambertMaterial( {
        map: texture,
        side: THREE.DoubleSide
     } );
    var planeMesh = new THREE.Mesh(planeGeom, material);
    var customMesh = new THREE.Mesh(customGeom(), material);
    scene.add(planeMesh);
    scene.add(customMesh);
    renderer.render(scene, cam);
}

function customGeom(xlen, ylen, interval) {
    var startX = 0;
    var endX = startX + xlen;
    var startY = 0;
    var endY = startY + ylen;
    var inter = parseInt(xlen/interval);
    var geometry = new THREE.Geometry();
    for (let i = 0; i < xlen; i++) {
        for (let i = 0; i < ylen; i++) {
            geometry.vertices.push(new THREE.Vector3(startX, startY + i * inter, Math.random()*10));
        }
        startY = 0;
    }

    // Face3 means a 3points- Patch consists vertice (index in vertices Arr)
    geometry.faces.push(new THREE.Face3(0,1,2));
    geometry.faces.push(new THREE.Face3(0,1,3));
    geometry.faces.push(new THREE.Face3(0,2,3));
    geometry.faces.push(new THREE.Face3(1,2,3));
    return geometry;
}

// load a resource
loader.load(
    // resource URL
    'img/1.jpg',
    // Function when resource is loaded
    addTexture,
    // Function called when download progresses
    function ( xhr ) {
        console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );
    },
    // Function called when download errors
    function ( xhr ) {
        console.log( 'An error happened' );
    }
);

</script>
</html>